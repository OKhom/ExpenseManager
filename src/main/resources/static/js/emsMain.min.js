function doLogin(t){$.ajax({url:"/api/users/auth",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e,a,r){setJwtToken(e.token),setLastUser(t.email)},error:function(t,e,a){401===t.status?alert("Authentication Error: "+t.responseJSON.message):alert("an unexpected error occurred: "+a)}})}function doRegister(t){$.ajax({url:"/api/users/register",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){setLastUser(t.email),window.location.assign("/login.html")},error:function(t,e,a){401===t.status?loginError(t):alert("an unexpected error occurred: "+a)}})}function loadTotalAmount(){$.ajax({url:"api/category/amount/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"GET",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#amountIncome").empty().append(parseInt(t.amountIncome.toFixed(0)).toLocaleString()+" "+t.currencySign),$("#amountExpense").empty().append(parseInt(t.amountExpense.toFixed(0)).toLocaleString()+" "+t.currencySign)},error:function(t,e,a){errorToConsole(t)}})}function loadAllCurrencies(t){$.ajax({url:"/api/category/currency",type:"GET",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorToConsole(t)}})}function loadTransactionById(t){$.ajax({url:"api/transaction/"+getCurrentTransactionID()+"/category/"+getCurrentCategoryID(),type:"GET",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorToConsole(t)}})}function loadCategoryById(t){$.ajax({url:"api/category/"+getCurrentCategoryID(),type:"GET",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorToConsole(t)}})}function loadSubcategories(t){$.ajax({url:"api/category/"+getCurrentCategoryID()+"/subcategory",type:"GET",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorToConsole(t)}})}function loadBudgetByCategoryId(t){$.ajax({url:"api/category/"+getCurrentCategoryID()+"/budget/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"GET",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorToConsole(t)}})}function loadTransactionCards(){$.ajax({url:"/api/transaction/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"GET",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#transactionCards").empty();for(let e=0;e<t.length;e++){let a,r,o=getColor(t[e].categoryId%getColorsNumber()),n=new Date(t[e].date);"EXPENSE"==t[e].type?(a="danger",r="-"):(a="success",r="+"),$("#transactionCards").append($("<div>").attr("class","card mb-4 py-2 border-bottom-"+o).append($("<div>").attr("class","card-body pr-1 py-0").append($("<div>").attr("class","row no-gutters align-items-top").append($("<div>").attr("class","col-auto mt-3 mr-3").append($("<i>").attr("class","fas fa-clipboard-list fa-2x text-"+o))).append($("<div>").attr("class","col mr-3").append($("<div>").attr("class","row no-gutters align-items-end").append($("<div>").attr("class","text-lg mb-0 mr-3 font-weight-bold text-gray-800 text-uppercase").append(n.toLocaleDateString("uk",{month:"long",day:"2-digit"})+" "+n.getFullYear())).append($("<div>").attr("class","text mb-0 mr-3 align-bottom font-weight-bold text-gray-800 text-uppercase").append(n.toLocaleDateString("uk",{weekday:"long"})))).append($("<div>").attr("class","row no-gutters align-items-end justify-content-between").append($("<div>").attr("class","row no-gutters align-items-end").append($("<div>").attr("class","text mb-0 mr-2 font-weight-bold text-uppercase text-"+o).append(t[e].categoryName)).append($("<div>").attr("class","text mb-0 mr-2 font-weight-bold text-uppercase text-gray-800").append(null!=t[e].subcategory?"("+t[e].subcategory+")":""))).append($("<div>").attr("class","text-lg mb-0 mr-0 font-weight-bold text-uppercase text-"+a).append(r+parseFloat(t[e].amount.toFixed(2)).toLocaleString()+" "+t[e].currencySign))).append($("<div>").attr("class","row no-gutters align-items-end").append($("<div>").attr("class","text-xs mb-0 mr-3 font-weight-bold font-italic text-gray-800").append(t[e].note)))).append($("<div>").attr("class","dropdown no-arrow").append($("<a>").attr("class","text dropdown-toggle").attr("id","transactionDropdown").attr("href","#").attr("role","button").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").append($("<i>").attr("class","fas fa-ellipsis-v fa-sm fa-fw text-gray-400"))).append($("<div>").attr("class","dropdown-menu").attr("aria-labelledby","transactionDropdown").append($("<a>").attr("class","dropdown-item").attr("href","#").attr("id","selectEditTransaction").attr("data-id",t[e].transactionId).attr("data-cat",t[e].categoryId).append("Edit transaction")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("id","selectDeleteTransaction").attr("data-id",t[e].transactionId).attr("data-cat",t[e].categoryId).append("Delete transaction")))))))}},error:function(t,e,a){errorToConsole(t)}})}function loadCategoryCards(){$.ajax({url:"/api/category/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1)+"/type/"+getCategoryType(),type:"GET",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#categoryCards").empty();for(let e=0;e<t.length;e++){let a,r=getColor(t[e].categoryId%getColorsNumber()),o=t[e].totalExpense,n=t[e].budget,s=n-o;0==n?(a="100",s=0):a=s<0?"100":(o/n*100).toFixed(0),$("#categoryCards").append($("<div>").attr("class","col-xl-3 col-md-6 mb-4").append($("<div>").attr("class","card border-left-"+r+" shadow h-100 py-2").append($("<div>").attr("class","card-body py-2").append($("<div>").attr("class","row no-gutters align-items-center").append($("<a>").attr("class","text mr-2").attr("href","#").attr("role","button").attr("data-id",t[e].categoryId).attr("id","selectAddTransaction").append($("<i>").attr("class","fas fa-clipboard-list fa-2x text-"+r))).append($("<div>").attr("class","col").append($("<div>").attr("class","card-title mb-0 d-flex flex-row align-items-start justify-content-between").append($("<div>").attr("class","text-xs font-weight-bold text-"+r+" text-uppercase mb-0").attr("href","#").attr("role","button").attr("data-id",t[e].categoryId).attr("id","selectAddTransaction").append(t[e].name)).append($("<div>").attr("class","dropdown no-arrow").append($("<a>").attr("class","text dropdown-toggle").attr("href","#").attr("role","button").attr("id","categoryDropdown").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").append($("<i>").attr("class","fas fa-ellipsis-v fa-sm fa-fw text-gray-400"))).append($("<div>").attr("class","dropdown-menu").attr("aria-labelledby","categoryDropdown").append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectAddBudget").append("Add budget")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectEditBudget").append("Edit budget")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectDeleteBudget").append("Delete budget")).append($("<div>").attr("class","dropdown-divider")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectAddSubcategory").append("Add subcategory")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectEditSubcategory").append("Edit subcategory")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectDeleteSubcategory").append("Delete subcategory")).append($("<div>").attr("class","dropdown-divider")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectEditCategory").append("Edit category")).append($("<a>").attr("class","dropdown-item").attr("href","#").attr("data-id",t[e].categoryId).attr("id","selectDeleteCategory").append("Delete category"))))).append($("<div>").attr("class","row mb-1 no-gutters align-items-center").append($("<div>").attr("class","col").append($("<div>").attr("class","progress progress-sm mr-2").attr("href","#").attr("role","button").attr("data-id",t[e].categoryId).attr("id","selectAddTransaction").append($("<div>").attr("class","progress-bar bg-"+r).attr("role","progressbar").attr("style","width: "+a+"%"))))).append($("<div>").attr("class","row no-gutters align-items-center d-flex flex-row justify-content-between").attr("href","#").attr("role","button").attr("data-id",t[e].categoryId).attr("id","selectAddTransaction").append($("<div>").attr("class","text-xs mb-0 mr-3 font-weight-bold text-gray-800").append(parseInt(o.toFixed(0)).toLocaleString()+" "+t[e].currencySign)).append($("<div>").attr("class","text-xs mb-0 font-weight-bold text-"+(s<0?"danger":"success")).append(parseInt(s.toFixed(0)).toLocaleString()+" "+t[e].currencySign))))))))}},error:function(t,e,a){errorToConsole(t)}})}function addCategory(t,e){$.ajax({url:"/api/category/"+e,type:"POST",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#addCategoryModal").modal("hide"),loadCategoryCards()},error:function(t,e,a){modalInputError(t,"#modalErrorText")}})}function updateCategory(t){$.ajax({url:"/api/category/"+getCurrentCategoryID(),type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#editCategoryModal").modal("hide"),loadCategoryCards()},error:function(t,e,a){modalInputError(t,"#modalEditCategoryErrorText")}})}function deleteCategory(t){$.ajax({url:"/api/category/"+getCurrentCategoryID(),type:"DELETE",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#deleteCategoryModal").modal("hide"),loadCategoryCards(),loadTotalAmount()},error:function(t,e,a){modalInputError(t,"#modalDeleteCategoryErrorText")}})}function addSubcategory(t,e){$.ajax({url:"/api/category/"+e+"/subcategory",type:"POST",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#addSubcategoryModal").modal("hide")},error:function(t,e,a){modalInputError(t,"#modalSubcategoryErrorText")}})}function updateSubcategory(t,e){$.ajax({url:"/api/category/"+getCurrentCategoryID()+"/subcategory/"+t,type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#updateSubcategoryModal").modal("hide")},error:function(t,e,a){modalInputError(t,"#modalUpdateSubcategoryErrorText")}})}function deleteSubcategory(t){$.ajax({url:"/api/category/"+getCurrentCategoryID()+"/subcategory/"+t,type:"DELETE",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#deleteSubcategoryModal").modal("hide")},error:function(t,e,a){modalInputError(t,"#modalDeleteSubcategoryErrorText")}})}function addBudget(t,e){$.ajax({url:"/api/category/"+e+"/budget/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"POST",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#addBudgetModal").modal("hide"),loadCategoryCards()},error:function(t,e,a){modalInputError(t,"#modalBudgetErrorText")}})}function editBudget(t,e){$.ajax({url:"/api/category/"+e+"/budget/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#editBudgetModal").modal("hide"),loadCategoryCards()},error:function(t,e,a){modalInputError(t,"#modalEditBudgetErrorText")}})}function deleteBudget(){$.ajax({url:"/api/category/"+getCurrentCategoryID()+"/budget/"+getCurrentYear()+"/"+(parseInt(getCurrentMonth())+1),type:"DELETE",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#deleteBudgetModal").modal("hide"),loadCategoryCards()},error:function(t,e,a){modalInputError(t,"#modalDeleteBudgetErrorText")}})}function addTransaction(t,e,a){let r="/api/transaction/category/"+e;null!=a&&(r=r+"/subcategory/"+a),$.ajax({url:r,type:"POST",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#addTransactionModal").modal("hide"),loadCategoryCards(),loadTotalAmount()},error:function(t,e,a){modalInputError(t,"#modalTransactionErrorText")}})}function editTransaction(t,e){let a="/api/transaction/"+getCurrentTransactionID()+"/category/"+getCurrentCategoryID();null!=e&&(a=a+"/subcategory/"+e),$.ajax({url:a,type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#editTransactionModal").modal("hide"),loadTransactionCards(),loadTotalAmount()},error:function(t,e,a){modalInputError(t,"#modalEditTransactionErrorText")}})}function deleteTransaction(){$.ajax({url:"/api/transaction/"+getCurrentTransactionID()+"/category/"+getCurrentCategoryID(),type:"DELETE",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#deleteTransactionModal").modal("hide"),loadTransactionCards(),loadTotalAmount()},error:function(t,e,a){modalInputError(t,"#modalDeleteTransactionErrorText")}})}function modalInputError(t,e){401===t.status?(console.log("Error Code is: "+t.status+" "+t.responseJSON.message),$(e).text("User Authorized invalid. Relogin and try again...")):400===t.status?(console.log("Error Code is: "+t.status+" "+t.responseJSON.message),$(e).text(t.responseJSON.message)):404===t.status?(console.log("Error Code is: "+t.status+" "+t.responseJSON.message),$(e).text("Entered Data is invalid. Try again...")):(console.log("Error Code is: "+t.status+" An unexpected error occurred: "+t.responseJSON.message),$(e).text("Error Code is: "+t.status+" "+t.responseJSON.message))}function errorToConsole(t){400===t.status?console.log("HTTP Status 400: "+t.responseJSON.message):401===t.status?console.log("HTTP Status 401: "+t.responseJSON.message):404===t.status?console.log("HTTP Status 404: "+t.responseJSON.message):500===t.status?console.log("HTTP Status 500: "+t.readyState+" StatusText "+t.statusText):console.log("an unexpected error occurred: "+t.status)}function loginError(t){$("#loginErrorModal").modal("show").find(".modal-body").empty().html("<p>"+t.responseJSON.message+"</p>")}function doLogout(){removeJwtToken(),window.location="/logout"}function createAuthorizationTokenHeader(){let t=getJwtToken();return t?{Authorization:"Bearer "+t}:{}}function updateUser(t){$.ajax({url:"/api/users/id",type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#editUserModal").modal("hide"),showUserInformation(function(t){$("#navUserName").empty().text(t.firstName+" "+t.lastName),$("#firstNameProfile").empty().text(t.firstName),$("#lastNameProfile").empty().text(t.lastName),$("#currencyProfile").empty().text("("+t.currencyShortName+") "+t.currencyName),setUserCurrency(t.currencyId),loadTotalAmount()})},error:function(t,e,a){modalInputError(t,"#modalEditUserErrorText")}})}function showUserInformation(t){$.ajax({url:"/api/users/id",type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorShowForm(t,e,a)}})}function showAdminInformation(t){$.ajax({url:"/api/admin/id",type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(e,a,r){t(e)},error:function(t,e,a){errorShowForm(t,e,a)}})}function loadPages(t){$.ajax({url:"/api/admin/count",type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(e,a,r){$("#quantityUsers").empty().text(e.count),$("#quantityCurrencies").empty().text(e.countCurrencies),$(t).empty();let o="#pages"===t?e.count:e.countCurrencies,n=o/e.pageSize+(o%e.pageSize>0?1:0);for(let e=1;e<=n;e++)$(t).append($("<li>").attr("class","page-item").append($("<a>").attr("class","page-link").attr("id",e-1).append(e)));"#pages"===t?$("#pageUsersNavbar").show():"#pagesCurrency"===t&&$("#pageCurrencyNavbar").show()},error:function(t,e,a){errorShowForm(t,e,a)}})}function loadData(t){$.ajax({url:"/api/admin/users/page/"+t,type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,e,a){usersDataBuilder(t)},error:function(t,e,a){errorShowForm(t,e,a)}})}function loadUsersDataByPattern(t){$.ajax({url:"/api/admin/users/search/"+t,type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,e,a){usersDataBuilder(t),$("#pageUsersNavbar").hide()},error:function(t,e,a){errorShowForm(t,e,a)}})}function usersDataBuilder(t){$("#dataUsers > tbody").empty();for(let e=0;e<t.length;e++)$("#dataUsers > tbody:last-child").append($("<tr>").append($("<td>").append($("<input>").attr("type","checkbox").attr("value",t[e].userId))).append($("<td>").append(t[e].email)).append($("<td>").append(t[e].firstName)).append($("<td>").append(t[e].lastName)).append($("<td>").append(t[e].currencyShortName)))}function loadCurrencyData(t){$.ajax({url:"/api/admin/currency/page/"+t,type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,e,a){currenciesDataBuilder(t)},error:function(t,e,a){errorShowForm(t,e,a)}})}function loadCurrenciesDataByPattern(t){$.ajax({url:"/api/admin/currency/search/"+t,type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,e,a){currenciesDataBuilder(t),$("#pageCurrencyNavbar").hide()},error:function(t,e,a){errorShowForm(t,e,a)}})}function currenciesDataBuilder(t){$("#dataCurrencies > tbody").empty();for(let e=0;e<t.length;e++)$("#dataCurrencies > tbody:last-child").append($("<tr>").append($("<td>").append($("<input>").attr("type","checkbox").attr("value",t[e].currencyId))).append($("<td>").append(t[e].name)).append($("<td>").append(t[e].shortName)).append($("<td>").append(t[e].sign)))}function loadCurrencyById(t,e){$.ajax({url:"/api/admin/currency/"+t,type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,a,r){e(t)},error:function(t,e,a){errorShowForm(t,e,a)}})}function usersCount(){$.ajax({url:"/api/admin/count",type:"GET",dataType:"json",headers:createAuthorizationTokenHeader(),success:function(t,e,a){$("#quantityUsers").empty().text(t.count),$("#quantityCurrencies").empty().text(t.countCurrencies)},error:function(t,e,a){errorShowForm(t,e,a)}})}function deleteUsers(t){$.ajax({url:"/api/admin/users",type:"DELETE",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){loadData(0),loadPages("#pages")},error:function(t,e,a){errorShowForm(t,e,a)}})}function deleteCurrencies(t){$.ajax({url:"/api/admin/currency",type:"DELETE",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){loadCurrencyData(0),loadPages("#pagesCurrency")},error:function(t,e,a){errorShowForm(t,e,a)}})}function addCurrency(t){$.ajax({url:"/api/admin/currency",type:"POST",headers:createAuthorizationTokenHeader(),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#addCurrencyModal").modal("hide"),loadCurrencyData(0),loadPages("#pagesCurrency")},error:function(t,e,a){modalInputError(t,"#modalAddCurrencyErrorText")}})}function editCurrency(t,e){$.ajax({url:"/api/admin/currency/"+t,type:"PUT",headers:createAuthorizationTokenHeader(),data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e,a){$("#editCurrencyModal").modal("hide"),loadCurrencyData(0),loadPages("#pagesCurrency")},error:function(t,e,a){modalInputError(t,"#modalEditCurrencyErrorText")}})}function errorShowForm(t,e,a){401===t.status?console.log("HTTP Status 401: "+t.responseJSON.message):403===t.status?(console.log("Access to Endpoint is Forbidden"),console.log("HTTP Status 403: "+e),window.location.replace("/login.html")):404===t.status?console.log("HTTP Status 404: "+t.responseJSON.message):302===t.status?console.log("HTTP Status 302: "+t.responseJSON.message+t.getAllResponseHeaders()):500===t.status?(console.log("HTTP Status 500 - Redirect page to LOGIN PAGE by STATE "+t.readyState+" StatusText "+t.statusText),window.location.replace("/login.html")):200===t.status&&"parsererror"===e?(console.log("Redirect page to ... by STATE "+t.readyState+" StatusText "+t.statusText),window.location.replace("/login.html")):console.log("an unexpected error occurred: "+t.status+" "+e+" "+a)}$("#logoutButton").click(doLogout);